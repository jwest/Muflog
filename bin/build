#!/usr/bin/env php
<?php
require 'vendor/autoload.php';

use Muflog\Builder\App;
use Muflog\Repository;
use Gaufrette\Filesystem;
use Gaufrette\Adapter\Local as LocalAdapter;

\Muflog\Pagination::itemsOnPage(3);
$posts = Repository::factory('post', new LocalAdapter('tests/fixtures/repository/posts'));
$pages = Repository::factory('page', new LocalAdapter('tests/fixtures/repository/pages'));

$output = new Filesystem(new LocalAdapter('web'));

$time = new Timer();
$time->start('total');

$startCb = function() use ($time) {
	$time->startAvg('page');
};

$endCb = function($route) use ($time) {
	Logger::log('Page `'.$route.'` converted');
 	$time->stopAvg('page');
};

$app = new App($posts, $output);
$app->addModule(new \Muflog\Module\Listing($posts));
$app->addModule(new \Muflog\Module\ListingByTag($posts), array_keys($posts->tags()));
$app->addModule(new \Muflog\Module\Post($posts), $posts->keys());
$app->build($startCb, $endCb);

$app = new App($pages, $output);
$app->addModule(new \Muflog\Module\Page($pages), $pages->keys());
$app->build($startCb, $endCb);

$time->stop('total');
echo $time->report();