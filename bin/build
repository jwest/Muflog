#!/usr/bin/env php
<?php
require 'vendor/autoload.php';

use Muflog\Builder\App;
use Muflog\Repository;
use Gaufrette\Filesystem;
use Gaufrette\Adapter\Local as LocalAdapter;

\Muflog\Pagination::itemsOnPage(3);
$repository = new Repository(new LocalAdapter('tests/fixtures/repository'));
$output = new Filesystem(new LocalAdapter('web'));

$time = new Timer();
$time->start('total');

$startCb = function() use ($time) {
	$time->startAvg('page');
};

$endCb = function($route) use ($time) {
	Logger::log('Page `'.$route.'` converted');
 	$time->stopAvg('page');
};

$app = new App($repository, $output);
$app->addModule(new \Muflog\Module\Listing($repository));
$app->addModule(new \Muflog\Module\ListingByTag($repository), array_keys($repository->tags()));
$app->addModule(new \Muflog\Module\Post($repository), $repository->keys());
$app->build($startCb, $endCb);

$time->stop('total');
$time->report();